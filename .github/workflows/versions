---
# This file contains all the versions of Arkime that are built and tested
# Arguments:
#   version - Unique identifier for the version, will be used in the filename, must be {platform}{seperator}{architecture}
#   buildopt: The options to use with easybutton-build.sh
#   container - Docker container to use for building the package
#   runson - The name of the runner to use for the build
#   package - Type of package to build: rpm, deb, arch
#   fpmdeps - Dependencies to pass to fpm
#   ja4plus - Build the ja4plus plugin, only need once per architecture, should be the same as docker!!!
#   docker - do docker stuff on this build
#   uitest - Should the UI tests be run
#   python - instead of just 'python'
#   notice - build the notice file, only need once
#   viewertest - run the viewer tests can be normal or sanitize
#   sanitizebuild - when set the command to use for latest-commit to build a sanitized version
#   prbuild - if True then this build is used for PR builds & main, otherwise just main


include:
  - version: el8.x86_64
    container: andywick/arkime-build-8:6.0.0-2
    buildopt: "--kafka --pfring"
    package: rpm
    fpmdeps: "-d perl-libwww-perl -d perl-JSON -d ethtool -d libyaml -d perl-LWP-Protocol-https -d python3.12-libs"
    uitest: true
    python: python3.12
    prbuild: true

  - version: el9.x86_64
    container: andywick/arkime-build-9:6.0.0-2
    buildopt: "--kafka --pfring"
    fpmdeps: "-d perl-libwww-perl -d perl-JSON -d ethtool -d libyaml -d perl-LWP-Protocol-https -d libzstd -d python3.12-libs"
    package: rpm
    notice: true
    python: python3
    prbuild: true

  - version: el10.x86_64
    container: andywick/arkime-build-10:6.0.0-2
    buildopt: "--kafka"
    fpmdeps: "-d perl-libwww-perl -d perl-JSON -d ethtool -d libyaml -d perl-LWP-Protocol-https -d libzstd -d libmaxminddb -d libpcap -d librdkafka -d python3-libs"
    package: rpm
    python: python3

  - version: ubuntu2204_amd64
    container: andywick/arkime-build-22:6.0.0-2
    buildopt: "--nothirdparty --kafka --pfring"
    fpmdeps: "-d libwww-perl -d libjson-perl -d ethtool -d libyaml-dev -d liblua5.4-0 -d libmaxminddb0 -d libcurl4 -d libpcap0.8 -d libglib2.0-0 -d libnghttp2-14 -d libyara8 -d librdkafka1"
    package: deb
    viewertest: sanitize
    sanitizebuild: make sanitize CC=clang-18
    prbuild: true

  - version: ubuntu2404_amd64
    container: andywick/arkime-build-24:6.0.0-2
    buildopt: "--nothirdparty --kafka"
    fpmdeps: "-d libwww-perl -d libjson-perl -d ethtool -d libyaml-dev -d liblua5.4-0 -d libmaxminddb0 -d libcurl4 -d libpcap0.8 -d libglib2.0-0 -d libnghttp2-14 -d libyara10 -d librdkafka1 -d libpcre3 -d libpython3.12"
    package: deb
    python: python3
    sanitizebuild: "make SANITIZE_LDFLAGS='-fno-common -fsanitize=address -fsanitize=undefined -fno-omit-frame-pointer' sanitize"

  - version: "arch-x86_64"
    container: andywick/arkime-build-arch:6.0.0-2
    buildopt: "--kafka"
    fpmdeps: "-d libmaxminddb -d libpcap -d yara -d perl-http-message -d perl-lwp-protocol-https -d perl-json -d libnet -d lua -d zstd -d openssl-1.1 -d pcre"
    package: arch
    viewertest: normal
    prbuild: true

  - version: al2023.x86_64
    container: andywick/arkime-build-al2023:6.0.0-2
    buildopt: "--kafka"
    fpmdeps: "-d perl-libwww-perl -d perl-JSON -d ethtool -d libyaml -d perl-LWP-Protocol-https"
    package: rpm

  - version: debian12_amd64
    container: andywick/arkime-build-d12:6.0.0-2
    buildopt: "--nothirdparty --kafka"
    fpmdeps: "-d libwww-perl -d libjson-perl -d ethtool -d libyaml-dev -d liblua5.4-0 -d libmaxminddb0 -d libcurl4 -d libpcap0.8 -d libglib2.0-0 -d libnghttp2-14 -d libyara9 -d librdkafka1 -d libpcre3"
    package: deb

  - version: debian13_amd64
    container: andywick/arkime-build-d13:6.0.0-3
    buildopt: "--nothirdparty --kafka"
    fpmdeps: "-d libwww-perl -d libjson-perl -d ethtool -d libyaml-dev -d liblua5.4-0 -d libmaxminddb0 -d libcurl4 -d libpcap0.8 -d libglib2.0-0 -d libnghttp2-14 -d libyara10 -d librdkafka1 -d libpython3.13"
    package: deb
    docker: true
    ja4plus: true
    prbuild: true

  ############# ARM #############
  - version: al2023.aarch64
    container: andywick/arkime-build-al2023-arm64:6.0.0-2
    buildopt: "--kafka"
    fpmdeps: "-d perl-libwww-perl -d perl-JSON -d ethtool -d libyaml -d perl-LWP-Protocol-https"
    package: rpm
    runson: ubuntu-24.04-arm

  - version: ubuntu2204_arm64
    container: andywick/arkime-build-22-arm64:6.0.0-2
    buildopt: "--nothirdparty --kafka"
    fpmdeps: "-d libwww-perl -d libjson-perl -d ethtool -d libyaml-dev -d liblua5.4-0 -d libmaxminddb0 -d libcurl4 -d libpcap0.8 -d libglib2.0-0 -d libnghttp2-14 -d libyara8 -d librdkafka1"
    package: deb
    runson: ubuntu-24.04-arm
    sanitizebuild: "make SANITIZE_LDFLAGS='-fno-common -fsanitize=address -fsanitize=undefined -fno-omit-frame-pointer' sanitize"

  - version: ubuntu2404_arm64
    container: andywick/arkime-build-24-arm64:6.0.0-2
    buildopt: "--nothirdparty --kafka"
    fpmdeps: "-d libwww-perl -d libjson-perl -d ethtool -d libyaml-dev -d liblua5.4-0 -d libmaxminddb0 -d libcurl4 -d libpcap0.8 -d libglib2.0-0 -d libnghttp2-14 -d libyara10 -d librdkafka1 -d libpcre3 -d libpython3.12"
    package: deb
    runson: ubuntu-24.04-arm
    sanitizebuild: "make SANITIZE_LDFLAGS='-fno-common -fsanitize=address -fsanitize=undefined -fno-omit-frame-pointer' sanitize"

  - version: debian12_arm64
    container: andywick/arkime-build-d12-arm64:6.0.0-2
    buildopt: "--nothirdparty --kafka"
    fpmdeps: "-d libwww-perl -d libjson-perl -d ethtool -d libyaml-dev -d liblua5.4-0 -d libmaxminddb0 -d libcurl4 -d libpcap0.8 -d libglib2.0-0 -d libnghttp2-14 -d libyara9 -d librdkafka1 -d libpcre3"
    package: deb
    runson: ubuntu-24.04-arm

  - version: debian13_arm64
    container: andywick/arkime-build-d13-arm64:6.0.0-3
    buildopt: "--nothirdparty --kafka"
    fpmdeps: "-d libwww-perl -d libjson-perl -d ethtool -d libyaml-dev -d liblua5.4-0 -d libmaxminddb0 -d libcurl4 -d libpcap0.8 -d libglib2.0-0 -d libnghttp2-14 -d libyara10 -d librdkafka1 -d libpython3.13"
    package: deb
    runson: ubuntu-24.04-arm
    docker: true
    ja4plus: true
    prbuild: true

  - version: el9.aarch64
    container: andywick/arkime-build-9-arm64:6.0.0-2
    buildopt: "--kafka"
    fpmdeps: "-d perl-libwww-perl -d perl-JSON -d ethtool -d libyaml -d perl-LWP-Protocol-https -d libzstd -d python3.12-libs"
    package: rpm
    runson: ubuntu-24.04-arm

  - version: el10.aarch64
    container: andywick/arkime-build-10-arm64:6.0.0-3
    buildopt: "--kafka"
    fpmdeps: "-d perl-libwww-perl -d perl-JSON -d ethtool -d libyaml -d perl-LWP-Protocol-https -d libzstd -d libmaxminddb -d libpcap -d librdkafka -d python3-libs"
    package: rpm
    runson: ubuntu-24.04-arm

  ############# FreeBSD #############
  - version: freebsd14.x86_64
    buildopt: "--kafka"
    vmaction: vmactions/freebsd-vm@v1
    vmaction-opts: "release: 14.3 usesh: true"
    fpmdeps: "-d glib -d yara -d libyaml -d libmaxminddb -d libuuid -d python312 -d libinotify"
    prbuild: true

  - version: freebsd15.x86_64
    buildopt: "--kafka"
    vmaction: vmactions/freebsd-vm@v1
    vmaction-opts: "release: 15.0 usesh: true"
    fpmdeps: "-d glib -d yara -d libyaml -d libmaxminddb -d libuuid -d python312 -d libinotify"
    prbuild: true

  - version: freebsd14.aarch64
    buildopt: "--kafka"
    vmaction: vmactions/freebsd-vm@v1
    vmaction-opts: "release: 14.3 arch: aarch64 usesh: true"
    fpmdeps: "-d glib -d yara -d libyaml -d libmaxminddb -d libuuid -d python312 -d libinotify"
    runson: ubuntu-24.04-arm

  - version: freebsd15.aarch64
    buildopt: "--kafka"
    vmaction: vmactions/freebsd-vm@v1
    vmaction-opts: "release: 15.0 arch: aarch64 usesh: true"
    fpmdeps: "-d glib -d yara -d libyaml -d libmaxminddb -d libuuid -d python312 -d libinotify"
    runson: ubuntu-24.04-arm
