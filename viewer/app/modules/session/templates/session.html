<div class="container-fluid margined-left margined-right">

  <moloch-search></moloch-search>

  <div class="row margin-for-search-navbar">
    <div class="col-md-4 margined-top" style="height:150px">
      <moloch-map></moloch-map>
    </div>
    <div class="col-md-8">
      <div ng-if="$ctrl.graphData">
        <session-graph graph-data="$ctrl.graphData"></session-graph>
      </div>
    </div>
  </div>

  <div class="margined-top-lg">

    <!-- top pagination controls -->
    <moloch-pagination length="$ctrl.query.length"
      records-total="$ctrl.sessions.recordsTotal"
      records-filtered="$ctrl.sessions.recordsFiltered"
      current-page="$ctrl.currentPage"
      start="$ctrl.query.start"></moloch-pagination>

    <!-- open session details -->
    <sticky-sessions ng-if="$ctrl.stickySessions && $ctrl.stickySessions.length > 0 && !$ctrl.error && !$ctrl.loading"
      sessions="$ctrl.stickySessions"></sticky-sessions>

    <div class="table-responsive margined-top-lg">
      <!-- session data table -->
      <table class="table table-condensed">
        <thead>
          <tr>
            <th>
              <div class="btn-group" uib-dropdown is-open="$ctrl.isopen">
                <button id="single-button" type="button" class="btn btn-purple"
                  uib-dropdown-toggle>
                  <span class="fa fa-th"></span>
                </button>
                <ul class="dropdown-menu" uib-dropdown-menu role="menu"
                  aria-labelledby="single-button">
                </ul>
              </div>
            </th>
            <th ng-class="{'active':$ctrl.isSorted('fp')}">
              <colheader col-name="'Start'" col-id="'fp'"
                sorts="$ctrl.query.sorts"></colheader>
            </th>
            <th ng-class="{'active':$ctrl.isSorted('lp')}">
              <colheader col-name="'Stop'" col-id="'lp'"
                sorts="$ctrl.query.sorts"></colheader>
            </th>
            <th ng-class="{'active':$ctrl.isSorted('a1')}">
              <colheader col-name="'Src IP'" col-id="'a1'"
                sorts="$ctrl.query.sorts"></colheader>
            </th>
            <th ng-class="{'active':$ctrl.isSorted('p1')}">
              <colheader col-name="'Src Port'" col-id="'p1'"
                sorts="$ctrl.query.sorts"></colheader>
            </th>
            <th ng-class="{'active':$ctrl.isSorted('a2')}">
              <colheader col-name="'Dst IP'" col-id="'a2'"
                sorts="$ctrl.query.sorts"></colheader>
            </th>
            <th ng-class="{'active':$ctrl.isSorted('p2')}">
              <colheader col-name="'Dst Port'" col-id="'p2'"
                sorts="$ctrl.query.sorts"></colheader>
            </th>
            <th ng-class="{'active':$ctrl.isSorted('pa')}">
              <colheader col-name="'Packets'" col-id="'pa'"
                sorts="$ctrl.query.sorts"></colheader>
            </th>
            <th ng-class="{'active':$ctrl.isSorted('by')}">
              <colheader col-name="'Bytes'" col-id="'by'"
                sorts="$ctrl.query.sorts"></colheader>
            </th>
            <th ng-class="{'active':$ctrl.isSorted('no')}">
              <colheader col-name="'Node'" col-id="'no'"
                sorts="$ctrl.query.sorts"></colheader>
            </th>
            <th>
              <colheader col-name="'Info'" col-id="'info'"></colheader>
            </th>
          </tr>
        </thead>
        <tbody ng-show="$ctrl.sessions && $ctrl.sessions.data &&
          $ctrl.sessions.data.length && !$ctrl.error" class="small">
          <tr ng-repeat-start="session in $ctrl.sessions.data"
            id="session{{::session.id}}">
            <td style="width:6%">
              <a class="btn btn-sm btn-green btn-toggle"
                ng-class="{'collapsed':!session.expanded}"
                ng-click="$ctrl.toggleSessionDetail(session)">
                <span class="fa fa-close"></span>
              </a>&nbsp;
              <small>{{::session.pr | protocol}}</small>
            </td>
            <td ng-class="{'active':$ctrl.isSorted('fp')}">
              {{::session.fp * 1000 | date:'yyyy/MM/dd'}}<br>
              {{::session.fp * 1000 | date:'HH:mm:ss'}}
            </td>
            <td ng-class="{'active':$ctrl.isSorted('lp')}">
              {{::session.lp * 1000 | date:'yyyy/MM/dd'}}<br>
              {{::session.lp * 1000 | date:'HH:mm:ss'}}
            </td>
            <td ng-class="{'active':$ctrl.isSorted('a1')}">
              {{::session | extractIPString:'src'}}<br>
              {{::session.g1}}
            </td>
            <td ng-class="{'active':$ctrl.isSorted('p1')}">
              {{::session.p1}}
            </td>
            <td ng-class="{'active':$ctrl.isSorted('a2')}">
              {{::session | extractIPString:'dst'}}<br>
              {{::session.g2}}
            </td>
            <td ng-class="{'active':$ctrl.isSorted('p2')}">
              {{::session.p2}}
            </td>
            <td ng-class="{'active':$ctrl.isSorted('pa')}">
              {{::session.pa}}
            </td>
            <td ng-class="{'active':$ctrl.isSorted('by')}">
              {{::session.db | number:0}} /<br>
              {{::session.by | number:0}}
            </td>
            <td ng-class="{'active':$ctrl.isSorted('no')}">
              {{::session.no}}
            </td>
            <td>{{::session.info}}</td>
          </tr>
          <tr ng-show="session.expanded" class="session-detail-row" ng-repeat-end>
            <td colspan="11">
              <span ng-if="session.expanded">
                <session-detail session="session">
                </session-detail>
              </span>
            </td>
          </tr>
        </tbody>
      </table> <!-- /session data table -->
    </div>

    <loading ng-if="$ctrl.loading"></loading>

    <error ng-if="$ctrl.error" message="$ctrl.error"></error>

    <!-- no results -->
    <div class="info-area vertical-horizontal-center"
     ng-if="!$ctrl.error && !$ctrl.sessions.data.length">
      <div ng-if="!$ctrl.loading">
        <span class="fa fa-3x text-center text-muted-more fa-folder-open"></span><br>
        No results or none that match your search.
      </div>
    </div> <!-- /no results -->

    <!-- bottom pagination controls -->
    <moloch-pagination length="$ctrl.query.length"
      records-total="$ctrl.sessions.recordsTotal"
      records-filtered="$ctrl.sessions.recordsFiltered"
      current-page="$ctrl.currentPage"
      ng-if="!$ctrl.loading && !$ctrl.error"
      start="$ctrl.query.start"></moloch-pagination>

  </div>

</div>
